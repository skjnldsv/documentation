

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Chunked file upload &mdash; Nextcloud latest Developer Manual latest documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'latest',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="comments.html" />
    <link rel="prev" title="Versions" href="versions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo-white.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../general/index.html">General contributor guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/index.html">App development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../android_library/index.html">Android application development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Client APIs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Webdav</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic.html">Basic APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="search.html">Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="trashbin.html">Trashbin</a></li>
<li class="toctree-l3"><a class="reference internal" href="versions.html">Versions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Chunked file upload</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../OCS/index.html">OCS API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LoginFlow/index.html">Login Flow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Core development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bugtracker/index.html">Bugtracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../commun/index.html">Help and communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Nextcloud latest Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Client APIs</a> &raquo;</li>
        
          <li><a href="index.html">Webdav</a> &raquo;</li>
        
      <li>Chunked file upload</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/nextcloud/documentation/edit/master/developer_manual/client_apis/WebDAV/chunking.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chunked-file-upload">
<h1>Chunked file upload<a class="headerlink" href="#chunked-file-upload" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Uploading large files is always a bit problematic as your connection can be interrupted
which will fail your entire upload. Nextcloud has a chunking API where you can
upload smaller chunks which will be assembled on the server once they are all uploaded.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The API is only available for registered users of your instance. And uses the path:
<code class="docutils literal"><span class="pre">&lt;server&gt;/remote.php/dav/uploads/&lt;userid&gt;</span></code>. For this guide we will assume:
<code class="docutils literal"><span class="pre">https://server/remote.php/dav/uploads/roeland</span></code></p>
<div class="section" id="starting-a-chunked-upload">
<h3>Starting a chunked upload<a class="headerlink" href="#starting-a-chunked-upload" title="Permalink to this headline">¶</a></h3>
<p>A chunked upload is handled in 1 folder. This is the location all the chunks
are uploaded to.</p>
<p>Start by creating a folder with a unique name. You can list the current available
folder but if you take a random UUID chances of collision are tiny.</p>
<p><code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">MKCOL</span> <span class="pre">-u</span> <span class="pre">roeland:pass</span> <span class="pre">https://server/remote.php/dav/uploads/roeland/myapp-e1663913-4423-4efe-a9cd-26e7beeca3c0</span></code></p>
</div>
<div class="section" id="uploading-chunks">
<h3>Uploading chunks<a class="headerlink" href="#uploading-chunks" title="Permalink to this headline">¶</a></h3>
<p>Once a folder for the chunks has been created we can start uploading the chunks.
We pose no limitations on the order or the sizes of the chunks you try to upload. which
means you can even adapt your chunk size to your available bandwidth. For example
if you switch from mobile internet to WiFi you might want to increase the chunk size.</p>
<p>We sort the chunks. Before assembling. So it is recommended to name them in a way
sorting always works.</p>
<p><code class="docutils literal"><span class="pre">XXXXXXXXXXXXXXX-YYYYYYYYYYYYYYY</span></code></p>
<p>Where <code class="docutils literal"><span class="pre">XXXXXXXXXXXXXXX</span></code> is the start byte of the chunk (with leading zeros) and
<code class="docutils literal"><span class="pre">YYYYYYYYYYYYYYY</span></code> is the end byte of the chunk with leading zeros.</p>
<p><code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">PUT</span> <span class="pre">-u</span> <span class="pre">roeland:pass</span> <span class="pre">https://server/remote.php/dav/uploads/roeland/myapp-e1663913-4423-4efe-a9cd-26e7beeca3c0/000000000000000-000000010485759</span> <span class="pre">-d</span> <span class="pre">&#64;chunk1</span></code>
<code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">PUT</span> <span class="pre">-u</span> <span class="pre">roeland:pass</span> <span class="pre">https://server/remote.php/dav/uploads/roeland/myapp-e1663913-4423-4efe-a9cd-26e7beeca3c0/000000010485760-000000015728640</span> <span class="pre">-d</span> <span class="pre">&#64;chunk2</span></code></p>
<p>This will upload 2 chunks of a file. The first chunk is 10MB in size and the second
chunk is 5MB in size.</p>
</div>
<div class="section" id="assembling-the-chunks">
<h3>Assembling the chunks<a class="headerlink" href="#assembling-the-chunks" title="Permalink to this headline">¶</a></h3>
<p>Assembling the chunk on the server is a matter of initiating a move from the client.</p>
<p><code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">MOVE</span> <span class="pre">-u</span> <span class="pre">roeland:pass</span> <span class="pre">--header</span> <span class="pre">'Destination:https://server/remote.php/dav/files/roeland/dest/file.zip'</span> <span class="pre">https://server/remote.php/dav/uploads/roeland/myapp-e1663913-4423-4efe-a9cd-26e7beeca3c0/.file</span></code></p>
<p>The server will now assemble the chunks and move the final file to the folder <code class="docutils literal"><span class="pre">dest/file.zip</span></code>.</p>
<p>If a modification time should be set, you can by adding it as header with date as unixtime:
<code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">MOVE</span> <span class="pre">-u</span> <span class="pre">roeland:pass</span> <span class="pre">--header</span> <span class="pre">'X-OC-Mtime:1547545326'</span> <span class="pre">--header</span> <span class="pre">'Destination:https://server/remote.php/dav/files/roeland/dest/file.zip'</span> <span class="pre">https://server/remote.php/dav/uploads/roeland/myapp-e1663913-4423-4efe-a9cd-26e7beeca3c0/.file</span></code>&#8221;
Otherwise the current upload date will be used as modification date.</p>
<p>The chunks and the upload folder will be deleted afterwards.</p>
</div>
<div class="section" id="aborting-the-upload">
<h3>Aborting the upload<a class="headerlink" href="#aborting-the-upload" title="Permalink to this headline">¶</a></h3>
<p>If the upload has to be aborted this is a simple matter or deleting the upload folder.</p>
<p><code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">DELETE</span> <span class="pre">-u</span> <span class="pre">roeland:pass</span> <span class="pre">https://server/remote.php/dav/uploads/roeland/myapp-e1663913-4423-4efe-a9cd-26e7beeca3c0/</span></code></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="comments.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="versions.html" class="btn btn-neutral float-left" title="Versions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 Nextcloud GmbH.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.nextcloud.com/server/16/developer_manual">16</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/17/developer_manual">17</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/18/developer_manual">18</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/stable/developer_manual">stable</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/latest/developer_manual">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="///projects//?fromdocs=">Project Home</a>
          </dd>
          <dd>
            <a href="///builds//?fromdocs=">Builds</a>
          </dd>
      </dl>
    </div>
  </div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>