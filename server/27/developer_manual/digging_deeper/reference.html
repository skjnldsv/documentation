<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reference providers &mdash; Nextcloud latest Developer Manual latest documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Projects" href="projects.html" />
    <link rel="prev" title="Dashboard" href="dashboard.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo-white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../prologue/index.html">Prologue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app_development/index.html">App development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">Core development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Digging deeper</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html">API reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="classloader.html">Classloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="continuous_integration.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l2"><a class="reference internal" href="flow.html">Nextcloud Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_client.html">HTTP Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript-apis.html">JavaScript APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="npm.html">NPM</a></li>
<li class="toctree-l2"><a class="reference internal" href="notifications.html">Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="psr.html">PSR</a></li>
<li class="toctree-l2"><a class="reference internal" href="publicpage.html">Public Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair.html">Repair steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest_apis.html">REST APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="search.html">Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="speech-to-text.html">Speech-To-Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="talk.html">Talk Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="translation.html">Machine Translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="text_processing.html">Text Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="two-factor-provider.html">Two-factor providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="users.html">User management</a></li>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Reference providers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#display-link-previews">Display link previews</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ncrichtext">NcRichText</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ncreferencewidget">NcReferenceWidget</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-to-resolve-links">API to resolve links</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-the-smart-picker-in-your-app">Use the Smart Picker in your app</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ncrichcontenteditable">NcRichContenteditable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ncreferencepickermodal">NcReferencePickerModal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getlinkwithpicker">getLinkWithPicker</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#register-a-reference-provider">Register a reference provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extend-link-preview-support">Extend link preview support</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#match-links">Match links</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resolving-links">Resolving links</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extend-the-smart-picker">Extend the Smart Picker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#declare-supported-unified-search-providers">Declare supported Unified Search providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-a-custom-picker-component">Register a custom picker component</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="projects.html">Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupware/index.html">Groupware integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_host_metadata.html">Web Host Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="status.html">User Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html">Profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_migration.html">User migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiler.html">Profiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app_publishing_maintenance/index.html">App publishing and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Nextcloud design guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../html_css_design/index.html">HTML/CSS guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_apis/index.html">Clients and Client APIs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nextcloud latest Developer Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Digging deeper</a></li>
      <li class="breadcrumb-item active">Reference providers</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/nextcloud/documentation/edit/master/developer_manual/digging_deeper/reference.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="reference-providers">
<span id="id1"></span><h1>Reference providers<a class="headerlink" href="#reference-providers" title="Permalink to this headline">ÔÉÅ</a></h1>
<p>Reference providers are related with two Nextcloud features:</p>
<ul class="simple">
<li><p>Link previews</p></li>
<li><p>The Smart Picker</p></li>
</ul>
<p>Link previews were introduced in Nextcloud 25.
Apps can register a reference provider to add preview support for some HTTP links.
To provide link previews, a reference provider needs to:</p>
<ul class="simple">
<li><p>Resolve the links (get information about the links)</p></li>
<li><p>Render links (show this information in the user interface)</p></li>
</ul>
<p>The Smart Picker was introduced in Nextcloud 26. This is a user interface component
allowing users to search or generate links from various places in Nextcloud like Text,
Talk, Collectives, Notes, Mail‚Ä¶
Reference providers can be implemented so they appear in the Smart Picker‚Äôs provider list.
The Smart Picker can use 2 types of providers:</p>
<ul class="simple">
<li><p>the ones to search (using existing Unified Search providers)</p></li>
<li><p>the ones implementing their own custom picker component</p></li>
</ul>
<p>In summary, reference providers can be registered by apps to</p>
<ul class="simple">
<li><dl class="simple">
<dt>add support for new kinds of HTTP links</dt><dd><ul>
<li><p>resolve the links, get information on the link targets</p></li>
<li><p>optionally provide their own reference widgets to have a custom preview rendering</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>extend the Smart Picker</dt><dd><ul>
<li><p>use existing Unified Search providers</p></li>
<li><p>or optionally register custom picker components to have a specific user interface</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>This documentation explains how to</p>
<ul class="simple">
<li><p>Display link previews in your app</p></li>
<li><p>Use the Smart Picker in your app</p></li>
<li><p>Extend the reference system add preview support for more links</p></li>
<li><p>Extend the Smart Picker with your app‚Äôs capabilities</p></li>
</ul>
<section id="display-link-previews">
<h2>Display link previews<a class="headerlink" href="#display-link-previews" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>If you just want to display links previews in your app without extending the reference system,
you need to make sure the <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\RenderReferenceEvent</span></code> is dispatched
before you load the page where you want to display link previews.</p>
<p>For example, you can place this before returning your TemplateResponse in your controller:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventDispatcher</span><span class="o">-&gt;</span><span class="na">dispatchTyped</span><span class="p">(</span><span class="k">new</span> <span class="nx">OCP\Collaboration\Reference\RenderReferenceEvent</span><span class="p">());</span>
</pre></div>
</div>
<p>This is done in
<a class="reference external" href="https://github.com/nextcloud/text/blob/8a17046aa440df841fe9182205d80ce937068c1a/lib/Listeners/LoadViewerListener.php#L52">Text</a>
and
<a class="reference external" href="https://github.com/nextcloud/spreed/blob/1f1acbd95943e6184e29de8044cd9d8e775ac7c5/lib/Controller/PageController.php#L280">Talk</a>
if you need more examples.</p>
<p>On the frontend side, there are 3 ways to display link previews (also named reference widgets):</p>
<ul class="simple">
<li><p>use the NcRichText Vue component</p></li>
<li><p>use the NcReferenceWidget Vue component</p></li>
<li><p>access the reference API directly and manually render the previews</p></li>
</ul>
<section id="ncrichtext">
<h3>NcRichText<a class="headerlink" href="#ncrichtext" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Link previews will be automatically rendered for links in the content of the <code class="docutils literal notranslate"><span class="pre">&lt;NcRichText&gt;</span></code> Vue component.
This component will take care of resolving the links itself.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">NcRichText</span> <span class="na">:text</span><span class="o">=</span><span class="s">&quot;message&quot;</span>
            <span class="na">:arguments</span><span class="o">=</span><span class="s">&quot;richParameters&quot;</span>
            <span class="na">:autolink</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
            <span class="na">:reference-limit</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
<p>NcRichText can be imported like this:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nx">NcRichText</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@nextcloud/vue/dist/Components/NcRichText.js&#39;</span>
</pre></div>
</div>
<p><a class="reference external" href="https://nextcloud-vue-components.netlify.app/#/Components/NcRichText?id=ncrichtext-1">NcRichText component documentation</a></p>
</section>
<section id="ncreferencewidget">
<h3>NcReferenceWidget<a class="headerlink" href="#ncreferencewidget" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>You can display a preview for a specific link by using the <code class="docutils literal notranslate"><span class="pre">&lt;NcReferenceWidget&gt;</span></code> component.
You need to ask the server to resolve the link to get a reference object that you can then give as a property
to NcReferenceWidget.</p>
<p>To resolve a link:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">myLink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://github.com&#39;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">requestOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reference</span><span class="o">:</span><span class="w"> </span><span class="nx">myLink</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">generateOcsUrl</span><span class="p">(</span><span class="s1">&#39;references/resolve&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="nx">requestOptions</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ocs</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">references</span><span class="p">[</span><span class="nx">myLink</span><span class="p">]</span>
<span class="w">    </span><span class="p">})</span>
</pre></div>
</div>
<p>Then you can use the reference object you got:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">NcReferenceWidget</span> <span class="na">:reference</span><span class="o">=</span><span class="s">&quot;reference&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
</section>
<section id="api-to-resolve-links">
<h3>API to resolve links<a class="headerlink" href="#api-to-resolve-links" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Accessing the API directly can be useful if you want to:</p>
<ul class="simple">
<li><p>resolve links from outside Nextcloud, in a client for example</p></li>
<li><p>manually resolve and render links instead of using the Vue components</p></li>
</ul>
<p>Endpoints to resolve links:</p>
<ul class="simple">
<li><dl class="simple">
<dt>GET /ocs/v2.php/references/resolve</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">reference</span></code> parameter which is the link to resolve</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>GET /ocs/v2.php/references/resolve</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">references</span></code> parameter which is an array of links to resolve</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> parameter which is the maximum number of links to resolve</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<section id="request-examples">
<h4>Request examples<a class="headerlink" href="#request-examples" title="Permalink to this headline">ÔÉÅ</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-u<span class="w"> </span>USER:PASSWD<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;ocs-apirequest: true&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;https://my.nextcloud.org/ocs/v2.php/references/resolve?reference=https://github.com&quot;</span>
</pre></div>
</div>
<p>will return an OCS response with that data:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;ocs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;statuscode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;references&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;https://github.com&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;richObjectType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;open-graph&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;richObject&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://github.com&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GitHub: Let‚Äôs build from here&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GitHub is where over 100 million developers shape the future of software, together. Contribute to the open source community, manage your Git repositories, review code like a pro, track bugs and fea...&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;thumb&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://my.nextcloud.org/core/references/preview/3097fca9b1ec8942c4305e550ef1b50a&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;link&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://github.com&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;openGraphObject&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://github.com&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GitHub: Let‚Äôs build from here&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GitHub is where over 100 million developers shape the future of software, together. Contribute to the open source community, manage your Git repositories, review code like a pro, track bugs and fea...&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;thumb&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://my.nextcloud.org/core/references/preview/3097fca9b1ec8942c4305e550ef1b50a&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;link&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://github.com&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;accessible&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The link might be supported by a reference provider that also provides more information in a rich object.
The generic openGraphObject is still returned. It contains a title, description and image URL if the matching reference
provider defined those correctly.
For example, resolving <code class="docutils literal notranslate"><span class="pre">https://www.themoviedb.org/movie/70981</span></code> if the <code class="docutils literal notranslate"><span class="pre">integration_tmdb</span></code> app is installed will return:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;references&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;https://www.themoviedb.org/movie/70981&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;richObjectType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integration_tmdb_movie&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;richObject&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;adult&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;budget&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">130000000</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;genres&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">878</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Science Fiction&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Adventure&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9648</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mystery&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;homepage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://www.20thcenturystudios.com/movies/prometheus&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">70981</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;imdb_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tt1446714&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;original_language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;original_title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prometheus&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;overview&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A team of explorers discover a clue to the origins of mankind on Earth, leading them on a journey to the darkest corners of the universe. There, they must fight a terrifying battle to save the future of the human race.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;popularity&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">68.389</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;release_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-05-30&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;revenue&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">403354469</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;runtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">124</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;openGraphObject&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://www.themoviedb.org/movie/70981&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prometheus&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30 mai 2012 - A team of explorers discover a clue to the origins of mankind on Earth, leading them on a journey to the darkest corners of the universe. There, they must fight a terrifying battle to save the future of the human race.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;thumb&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://my.nextcloud.org/apps/integration_tmdb/t/p/w500/qsYQflQhOuhDpQ0W2aOcwqgDAeI.jpg?fallbackName=???&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;link&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://www.themoviedb.org/movie/70981&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;accessible&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="use-the-smart-picker-in-your-app">
<h2>Use the Smart Picker in your app<a class="headerlink" href="#use-the-smart-picker-in-your-app" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>There are 3 ways to make the Smart Picker appear in your app:</p>
<ul class="simple">
<li><p>use the <code class="docutils literal notranslate"><span class="pre">NcRichContenteditable</span></code> component</p></li>
<li><p>use the <code class="docutils literal notranslate"><span class="pre">NcReferencePickerModal</span></code> component</p></li>
<li><p>use the <code class="docutils literal notranslate"><span class="pre">getLinkWithPicker</span></code> helper function</p></li>
</ul>
<p>Just like for the link previews, you need to dispatch the <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\RenderReferenceEvent</span></code> event
before loading the page in which you want to show the Smart Picker.</p>
<section id="ncrichcontenteditable">
<h3>NcRichContenteditable<a class="headerlink" href="#ncrichcontenteditable" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>The Smart Picker is integrated in the NcRichContenteditable Vue component. It is enabled by default
but can be disabled by setting the <code class="docutils literal notranslate"><span class="pre">linkAutocomplete</span></code> prop to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>The picker provider list opens when the user types the ‚Äú/‚Äù character.
The picker result then gets directly inserted in the content.</p>
<p><a class="reference external" href="https://nextcloud-vue-components.netlify.app/#/Components/NcRichContenteditable">NcRichContenteditable component documentation</a></p>
</section>
<section id="ncreferencepickermodal">
<h3>NcReferencePickerModal<a class="headerlink" href="#ncreferencepickermodal" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>You display the Smart Picker by using the NcReferencePickerModal Vue component. It is available in the Nextcloud Vue library.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">NcReferencePickerModal</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@nextcloud/vue/dist/Components/NcRichText.js&#39;</span>
</pre></div>
</div>
<p>Available props:</p>
<ul class="simple">
<li><p>initialProvider (optional): If a reference provider object is passed, skip the provider selection and directly show this provider</p></li>
<li><p>focusOnCreate (optional, default: true): Focus on the main input element on creation</p></li>
<li><p>isInsideViewer (optional, default: false): Set this to true if NcReferencePickerModal is used inside the Viewer. This tells the Viewer to deal with the focus trap.</p></li>
</ul>
</section>
<section id="getlinkwithpicker">
<h3>getLinkWithPicker<a class="headerlink" href="#getlinkwithpicker" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>To display the Smart Picker outside Vue, you can use the getLinkWithPicker helper function.
It takes 2 parameters:</p>
<ul class="simple">
<li><p>providerId (optional, default: null): The provider to select in the picker. If null, the provider selection is displayed first.</p></li>
<li><p>isInsideViewer (optional): This will be passed internally to NcReferencePickerModal as the isInsideViewer prop.</p></li>
</ul>
<p>This function returns a promise that resolves with the picker result. This promise is rejected if the user closes
the Smart Picker.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getLinkWithPicker</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@nextcloud/vue/dist/Components/NcRichText.js&#39;</span>

<span class="nx">getLinkWithPicker</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;Smart Picker result&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Smart Picker promise rejected&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
</pre></div>
</div>
</section>
</section>
<section id="register-a-reference-provider">
<h2>Register a reference provider<a class="headerlink" href="#register-a-reference-provider" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>A reference provider is a class implementing the <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\IReferenceProvider</span></code> interface.
If you just want to resolve links, simply implement the <code class="docutils literal notranslate"><span class="pre">IReferenceProvider</span></code> interface.
This is described in the ‚ÄúResolving links‚Äù section.</p>
<p>If you want your reference provider to be used by the Smart Picker, you need to extend the
<code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\ADiscoverableReferenceProvider</span></code> class to declare all required information.
There are 2 ways to make your provider appear in the smart picker, in other words, 2 types of providers:</p>
<ul class="simple">
<li><p>Either your reference provider implements the <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\ISearchableReferenceProvider</span></code> interface and you declare a list of unified search providers that will be used by the Smart Picker</p></li>
<li><p>Or you don‚Äôt implement this <code class="docutils literal notranslate"><span class="pre">ISearchableReferenceProvider</span></code> interface and make sure you register a custom picker component in the frontend. This is described later in this documentation.</p></li>
</ul>
</section>
<section id="extend-link-preview-support">
<h2>Extend link preview support<a class="headerlink" href="#extend-link-preview-support" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>This section is focusing on the methods of the <code class="docutils literal notranslate"><span class="pre">IReferenceProvider</span></code> interface.</p>
<p>Links that are not matched by any reference provider will always be handled by the server‚Äôs OpenGraph provider as a fallback.
This provider will try to get the information declared in the target page‚Äôs meta tag. The link preview will be rendered with the
default widget.</p>
<p>For your provider to properly handle some links,
you need to implement the <code class="docutils literal notranslate"><span class="pre">matchReference</span></code> and <code class="docutils literal notranslate"><span class="pre">resolve</span></code> methods of <code class="docutils literal notranslate"><span class="pre">IReferenceProvider</span></code>.</p>
<section id="match-links">
<h3>Match links<a class="headerlink" href="#match-links" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">matchReference</span></code> method of <code class="docutils literal notranslate"><span class="pre">IReferenceProvider</span></code> tells the reference manager if a provider supports a link or not.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">matchReference</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$referenceText</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span>
    <span class="c1">// support all URLs starting with https://my.website.org/</span>
    <span class="k">return</span> <span class="nb">str_starts_with</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">,</span> <span class="s1">&#39;https://my.website.org/&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="resolving-links">
<h3>Resolving links<a class="headerlink" href="#resolving-links" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">resolve</span></code> method of <code class="docutils literal notranslate"><span class="pre">IReferenceProvider</span></code> is used to get information about a link and return it as a
<code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\Reference</span></code> object.</p>
<section id="using-the-default-widget">
<h4>Using the default widget<a class="headerlink" href="#using-the-default-widget" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>If you are fine with the default widget rendering (image on the left, text and subtext on the right),
then you just need to provide a title, a description and optionally an image.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">resolveReference</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$referenceText</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">IReference</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">matchReference</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getLinkTitle</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$description</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getLinkDescription</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$imageUrl</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getImageUrl</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>

        <span class="nv">$reference</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="nv">$title</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="nv">$description</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setImageUrl</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$reference</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="using-custom-reference-widgets">
<h4>Using custom reference widgets<a class="headerlink" href="#using-custom-reference-widgets" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>You can customize the rendering of the links you support with your provider.</p>
<p>On the provider side, you need to pass all the information needed by your
custom reference widget component by setting the ‚Äúrich object‚Äù of the <code class="docutils literal notranslate"><span class="pre">Reference</span></code>
object returned by the <code class="docutils literal notranslate"><span class="pre">resolve</span></code> method.</p>
<p>It is recommended to still set the title, description and image URL on the reference object
in case it is used by a client or in a context where the custom reference widgets can‚Äôt be used.
This way we make sure any generic rendering of link previews still shows some information.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">resolveReference</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$referenceText</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">IReference</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">matchReference</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getLinkTitle</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$description</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getLinkDescription</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$imageUrl</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getImageUrl</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$extraInformation</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myAwesomeService</span><span class="o">-&gt;</span><span class="na">getExtraInformation</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>

        <span class="nv">$reference</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="nv">$referenceText</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="nv">$title</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="nv">$description</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setImageUrl</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">);</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">setRichObject</span><span class="p">(</span>
            <span class="s1">&#39;my_rich_object_type&#39;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nv">$description</span><span class="p">,</span>
                <span class="s1">&#39;image_url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$imageUrl</span><span class="p">,</span>
                <span class="s1">&#39;extra_info&#39;</span> <span class="o">=&gt;</span> <span class="nv">$extraInformation</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="k">return</span> <span class="nv">$reference</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On the frontend side you need to implement and register your custom component. Here is a component example:</p>
<p>You need to react to the <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\RenderReferenceEvent</span></code>
event to inject a script that will actually register the widget component when needed.
For example, in your <code class="docutils literal notranslate"><span class="pre">lib/AppInfo/Application.php</span></code> file:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$context</span><span class="o">-&gt;</span><span class="na">registerEventListener</span><span class="p">(</span><span class="nx">OCP\Collaboration\Reference\RenderReferenceEvent</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">MyReferenceListener</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</pre></div>
</div>
<p>The corresponding <code class="docutils literal notranslate"><span class="pre">MyReferenceListener</span></code> class can look like:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">namespace</span> <span class="nx">OCA\MyApp\Listener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">OCA\MyApp\AppInfo\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">OCP\Collaboration\Reference\RenderReferenceEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">OCP\EventDispatcher\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">OCP\EventDispatcher\IEventListener</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">OCP\Util</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyReferenceListener</span> <span class="k">implements</span> <span class="nx">IEventListener</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$event</span> <span class="nx">instanceof</span> <span class="nx">RenderReferenceEvent</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">Util</span><span class="o">::</span><span class="na">addScript</span><span class="p">(</span><span class="nx">Application</span><span class="o">::</span><span class="na">APP_ID</span><span class="p">,</span> <span class="s1">&#39;myapp-reference&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">myapp-reference.js</span></code> file contains the widget registration:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">registerWidget</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@nextcloud/vue-richtext&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Vue</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">MyCustomWidgetComponent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./MyCustomWidgetComponent.vue&#39;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">mixin</span><span class="p">({</span><span class="w"> </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span>

<span class="c1">// here we register the MyCustomWidgetComponent to handle rich objects which type is &#39;my_rich_object_type&#39;</span>
<span class="nx">registerWidget</span><span class="p">(</span><span class="s1">&#39;my_rich_object_type&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">richObjectType</span><span class="p">,</span><span class="w"> </span><span class="nx">richObject</span><span class="p">,</span><span class="w"> </span><span class="nx">accessible</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">Widget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">MyCustomWidgetComponent</span><span class="p">)</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">Widget</span><span class="p">({</span>
<span class="w">        </span><span class="nx">propsData</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">richObjectType</span><span class="p">,</span>
<span class="w">            </span><span class="nx">richObject</span><span class="p">,</span>
<span class="w">            </span><span class="nx">accessible</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
<p>And last but not least, the MyCustomWidgetComponent Vue component in which you can render the link preview
in a custom fashion:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;richObject&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>
                {{ t(&#39;myapp&#39;, &#39;Title&#39; }}
            <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                {{ richObject.title }}
            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>
                {{ t(&#39;myapp&#39;, &#39;Extra info&#39; }}
            <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                {{ richObject.extra_info }}
            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MyCustomWidgetComponent&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">props</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">richObjectType</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">richObject</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">Object</span><span class="p">,</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">accessible</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">,</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="extend-the-smart-picker">
<h2>Extend the Smart Picker<a class="headerlink" href="#extend-the-smart-picker" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>If you want your reference provider to appear in the Smart Picker to search/get links,
it needs to be discoverable
(extend the <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\ADiscoverableReferenceProvider</span></code> abstract class)
and either</p>
<ul class="simple">
<li><p>support one or multiple Unified Search providers</p></li>
<li><p>or register a custom picker component</p></li>
</ul>
<p>This is an exclusive choice. You can‚Äôt support search providers AND register a custom picker component.
If you still want to mix both approaches, you can register a custom picker component which includes a custom search feature.</p>
<p>Extending <code class="docutils literal notranslate"><span class="pre">ADiscoverableReferenceProvider</span></code> implies defining those methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getId</span></code>: returns an ID which will be used by the Smart Picker to identify this provider</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getTitle</span></code>: returns a (ideally translated) provider title visible in the Smart Picker provider list</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrder</span></code>: returns an integer to help sorting the providers. The sort order is later superseeded by last usage timestamp</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getIconUrl</span></code>: returns the URL of the provider icon, same as the title, the icon will be visible in the provider list</p></li>
</ul>
<section id="declare-supported-unified-search-providers">
<h3>Declare supported Unified Search providers<a class="headerlink" href="#declare-supported-unified-search-providers" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>If you want your reference provider to let users pick links from unified search results, your reference provider must
implement <code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\ISearchableReferenceProvider</span></code> and define the <code class="docutils literal notranslate"><span class="pre">getSupportedSearchProviderIds</span></code>
method which return a list of supported search provider IDs.</p>
<p>Once this provider is selected in the Smart Picker, users will see a generic search interface giving results from
all the search providers you declared as supported. Once a result is selected, the Smart Picker will return
the associated resource URL.</p>
</section>
<section id="register-a-custom-picker-component">
<h3>Register a custom picker component<a class="headerlink" href="#register-a-custom-picker-component" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>On the backend side, in your <code class="docutils literal notranslate"><span class="pre">lib/AppInfo/Application.php</span></code>, you should listen to the
<code class="docutils literal notranslate"><span class="pre">OCP\Collaboration\Reference\RenderReferenceEvent</span></code>. In the corresponding listener, you should load
the scripts that will register custom picker components.</p>
<p>In other words, when the <code class="docutils literal notranslate"><span class="pre">RenderReferenceEvent</span></code> event is dispatched,
the Smart Picker will potentially by used in the frontend so you need to load the related scripts from your app.</p>
<p>You can define your own picker user interface for your provider by registering a custom picker component.
This can be done with the
<code class="docutils literal notranslate"><span class="pre">registerCustomPickerElement</span></code> function from <code class="docutils literal notranslate"><span class="pre">&#64;nextcloud/vue-richtext</span></code> (&gt;= 2.1.0-beta.5).
This function takes 3 parameters:</p>
<ul class="simple">
<li><p>The reference provider ID for which you register the custom picker component</p></li>
<li><p>The callback function to create and mount your component</p></li>
<li><p>The callback function to delete/destroy your component</p></li>
</ul>
<p>The creation callback must return a <code class="docutils literal notranslate"><span class="pre">CustomPickerRenderResult</span></code> object to which you have to give the DOM element
you just created and optionally an object (the Vue instance for example).
This render result will be then be passed to the destroy callback to let you properly clean and delete your custom component.</p>
<p>To register a Vue component as a custom picker component:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">registerCustomPickerElement</span><span class="p">,</span><span class="w"> </span><span class="nx">CustomPickerRenderResult</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@nextcloud/vue-richtext&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Vue</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">MyCustomPickerElement</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./MyCustomPickerElement.vue&#39;</span>

<span class="nx">registerCustomPickerElement</span><span class="p">(</span><span class="s1">&#39;REFERENCE_PROVIDER_ID&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">providerId</span><span class="p">,</span><span class="w"> </span><span class="nx">accessible</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">Element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">MyCustomPickerElement</span><span class="p">)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">vueElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Element</span><span class="p">({</span>
<span class="w">        </span><span class="nx">propsData</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">providerId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">accessible</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CustomPickerRenderResult</span><span class="p">(</span><span class="nx">vueElement</span><span class="p">.</span><span class="nx">$el</span><span class="p">,</span><span class="w"> </span><span class="nx">vueElement</span><span class="p">)</span>
<span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="w"> </span><span class="nx">renderResult</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// call the $destroy method on your custom element&#39;s Vue instance</span>
<span class="w">    </span><span class="nx">renderResult</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">()</span>
<span class="p">})</span>
</pre></div>
</div>
<p>To register anything else:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">registerCustomPickerElement</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CustomPickerRenderResult</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@nextcloud/vue-richtext&#39;</span>

<span class="nx">registerCustomPickerElement</span><span class="p">(</span><span class="s1">&#39;REFERENCE_PROVIDER_ID&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">providerId</span><span class="p">,</span><span class="w"> </span><span class="nx">accessible</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">paragraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">paragraph</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;click this button to return a link&#39;</span>
<span class="w">    </span><span class="nx">el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">paragraph</span><span class="p">)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">button</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;I am a button&#39;</span>
<span class="w">    </span><span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CustomEvent</span><span class="p">(</span>
<span class="w">            </span><span class="s1">&#39;submit&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">bubbles</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="nx">detail</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://nextcloud.com&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="nx">el</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">button</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CustomPickerRenderResult</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
<span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="w"> </span><span class="nx">renderResult</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">renderResult</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
<span class="p">})</span>
</pre></div>
</div>
<p>In your custom component, just emit the <code class="docutils literal notranslate"><span class="pre">submit</span></code> event with the result as the event‚Äôs data to pass it back to the Smart Picker.
You can also emit the <code class="docutils literal notranslate"><span class="pre">cancel</span></code> event to abort and go back.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dashboard.html" class="btn btn-neutral float-left" title="Dashboard" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="projects.html" class="btn btn-neutral float-right" title="Projects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Nextcloud GmbH.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.nextcloud.com/server/25/developer_manual">25</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/26/developer_manual">26</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/27/developer_manual">27</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/stable/developer_manual">stable</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/latest/developer_manual">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="///projects//?fromdocs=">Project Home</a>
          </dd>
          <dd>
            <a href="///builds//?fromdocs=">Builds</a>
          </dd>
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>