<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hooks &#8212; Nextcloud Developer Manual 12 documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/main.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Background Jobs (Cron)" href="backgroundjobs.html" />
    <link rel="prev" title="Two-factor Providers" href="two-factor-provider.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1d2d44">
<link rel="shortcut icon" href="https://nextcloud.com/wp-content/themes/next/assets/img/common/favicon.png" />
<link rel="apple-touch-icon-precomposed" href="https://nextcloud.com/wp-content/themes/next/assets/img/common/favicon.png" />
<!-- Piwik -->
<script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//stats.nextcloud.com/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 3]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<noscript><p><img src="//stats.nextcloud.com/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

  </head>
  <body role="document">

<header class="banner navbar navbar-default navbar-static-top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="brand" href="http://nextcloud.com/" rel="home" title="Nextcloud.com"><img class="logo" src="../_static/img/logo.svg" itemprop="logo"></a>
    </div>

    <nav class="collapse navbar-collapse" role="navigation">
      <ul id="menu-header" class="nav navbar-nav">
          <li><a target="_blank" href="https://demo.nextcloud.com">Demo</a></li>
          <li><a href="https://nextcloud.com/news/">News</a></li>
          <li><a href="https://nextcloud.com/features/">Features</a></li>
          <li><a href="https://nextcloud.com/about/">About us</a></li>
          <li><a href="https://nextcloud.com/contribute/">Get involved</a></li>
          <li><a href="https://nextcloud.com/support/">Support</a></li>
          <li><a href="https://nextcloud.com/enterprise/">Enterprise</a></li>
          <li class="menu-install"><a href="https://nextcloud.com/install/">Download</a></li>
      </ul>
    </nav>
  </div>
</header>




<div class="container" style="background-color: #E6C4C2;color: #b10000;border: #b10000 2px solid;border-right: none;border-left: none;padding: 15px 10px;">You are reading an outdated version of this documentation. Please check out the <a href="https://docs.nextcloud.com/server/stable/developer_manual/" style="
color: rgb(177,0,0);text-decoration: underline;">latest version</a> of the developer manual.</div>





<div class="wrap container not-front">
  <div class="content row">
  <main class="main">
    <div class="row page-content-header">
      <div class="col-md-6">
        <h1><a href="../index.html">Nextcloud Developer Manual</a></h1>
      </div>
      <div class="col-md-5 col-md-offset-1">
      
        <form class="headersearch" style="margin: 16px 0;" action="../search.html" method="get">
        <input type="text" value="" name="q" id="q" class="form-control" /> 
        <button  class="btn btn-default" type="submit" id="searchsubmit">Search</button>
        </form>
      
      </div>
    </div>
    
			<div class="row">
				<div class="col-md-3">
					<div class="sidebar">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										
<li><a href="../index.html">Table of Contents</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">General Contributor Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">App Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../android_library/index.html">Android Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_apis/index.html">Client APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">Core Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bugtracker/index.html">Bugtracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commun/index.html">Help and Communication</a></li>
</ul>

								</ul>
							</div>
					</div>
				</div>
        

				<div class="col-md-9">
					<div class="page-content">
            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="two-factor-provider.html" title="Previous Chapter: Two-factor Providers"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Two-factor Providers</span>
    </a>
  </li>
  <li class="next">
    <a href="backgroundjobs.html" title="Next Chapter: Background Jobs (Cron)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Background Jo... &raquo;</span>
    </a>
  </li>
</ul>
						
  <div class="section" id="hooks">
<h1>Hooks<a class="headerlink" href="#hooks" title="Permalink to this headline">¶</a></h1>
<p>Hooks are used to execute code before or after an event has occurred. This is for instance useful to run cleanup code after users, groups or files have been deleted. Hooks should be registered in the <a class="reference internal" href="init.html"><span class="doc">app.php</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">OCA\MyApp\AppInfo</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;UserHooks&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</pre></div>
</div>
<p>The hook logic should be in a separate class that is being registered in the <a class="reference internal" href="container.html"><span class="doc">Container</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">OCA\MyApp\AppInfo</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">\OCP\AppFramework\App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">\OCA\MyApp\Hooks\UserHooks</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nx">App</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">array</span> <span class="nv">$urlParams</span><span class="o">=</span><span class="k">array</span><span class="p">()){</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="s1">&#39;myapp&#39;</span><span class="p">,</span> <span class="nv">$urlParams</span><span class="p">);</span>

        <span class="nv">$container</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>

        <span class="sd">/**</span>
<span class="sd">         * Controllers</span>
<span class="sd">         */</span>
        <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">registerService</span><span class="p">(</span><span class="s1">&#39;UserHooks&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">UserHooks</span><span class="p">(</span>
                <span class="nv">$c</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;ServerContainer&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getUserManager</span><span class="p">()</span>
            <span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">OCA\MyApp\Hooks</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">OCP\IUserManager</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserHooks</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nv">$userManager</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">IUserManager</span> <span class="nv">$userManager</span><span class="p">){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userManager</span> <span class="o">=</span> <span class="nv">$userManager</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$callback</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// your code that executes before $user is deleted</span>
        <span class="p">};</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userManager</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span><span class="s1">&#39;\OC\User&#39;</span><span class="p">,</span> <span class="s1">&#39;preDelete&#39;</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="available-hooks">
<h2>Available hooks<a class="headerlink" href="#available-hooks" title="Permalink to this headline">¶</a></h2>
<p>The scope is the first parameter that is passed to the <strong>listen</strong> method, the second parameter is the method and the third one the callback that should be executed once the hook is being called, e.g.:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// listen on user predelete</span>
<span class="nv">$callback</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// your code that executes before $user is deleted</span>
<span class="p">};</span>
<span class="nv">$userManager</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span><span class="s1">&#39;\OC\User&#39;</span><span class="p">,</span> <span class="s1">&#39;preDelete&#39;</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
</pre></div>
</div>
<p>Hooks can also be removed by using the <strong>removeListener</strong> method on the object:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// delete previous callback</span>
<span class="nv">$userManager</span><span class="o">-&gt;</span><span class="na">removeListener</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
</pre></div>
</div>
<p>The following hooks are available:</p>
<div class="section" id="session">
<h3>Session<a class="headerlink" href="#session" title="Permalink to this headline">¶</a></h3>
<p>Injectable from the ServerContainer by calling the method <strong>getUserSession()</strong>.</p>
<p>Hooks available in scope <strong>\OC\User</strong>:</p>
<ul class="simple">
<li><strong>preSetPassword</strong> (\OC\User\User $user, string $password, string $recoverPassword)</li>
<li><strong>postSetPassword</strong> (\OC\User\User $user, string $password, string $recoverPassword)</li>
<li><strong>changeUser</strong> (\OC\User\User $user, string $feature, string $value)</li>
<li><strong>preDelete</strong> (\OC\User\User $user)</li>
<li><strong>postDelete</strong> (\OC\User\User $user)</li>
<li><strong>preCreateUser</strong> (string $uid, string $password)</li>
<li><strong>postCreateUser</strong> (\OC\User\User $user)</li>
<li><strong>preLogin</strong> (string $user, string $password)</li>
<li><strong>postLogin</strong> (\OC\User\User $user, string $password)</li>
<li><strong>logout</strong> ()</li>
</ul>
</div>
<div class="section" id="usermanager">
<h3>UserManager<a class="headerlink" href="#usermanager" title="Permalink to this headline">¶</a></h3>
<p>Injectable from the ServerContainer by calling the method <strong>getUserManager()</strong>.</p>
<p>Hooks available in scope <strong>\OC\User</strong>:</p>
<ul class="simple">
<li><strong>preSetPassword</strong> (\OC\User\User $user, string $password, string $recoverPassword)</li>
<li><strong>postSetPassword</strong> (\OC\User\User $user, string $password, string $recoverPassword)</li>
<li><strong>preDelete</strong> (\OC\User\User $user)</li>
<li><strong>postDelete</strong> (\OC\User\User $user)</li>
<li><strong>preCreateUser</strong> (string $uid, string $password)</li>
<li><strong>postCreateUser</strong> (\OC\User\User $user, string $password)</li>
</ul>
</div>
<div class="section" id="groupmanager">
<h3>GroupManager<a class="headerlink" href="#groupmanager" title="Permalink to this headline">¶</a></h3>
<p>Hooks available in scope <strong>\OC\Group</strong>:</p>
<ul class="simple">
<li><strong>preAddUser</strong> (\OC\Group\Group $group, \OC\User\User $user)</li>
<li><strong>postAddUser</strong> (\OC\Group\Group $group, \OC\User\User $user)</li>
<li><strong>preRemoveUser</strong> (\OC\Group\Group $group, \OC\User\User $user)</li>
<li><strong>postRemoveUser</strong> (\OC\Group\Group $group, \OC\User\User $user)</li>
<li><strong>preDelete</strong> (\OC\Group\Group $group)</li>
<li><strong>postDelete</strong> (\OC\Group\Group $group)</li>
<li><strong>preCreate</strong> (string $groupId)</li>
<li><strong>postCreate</strong> (\OC\Group\Group $group)</li>
</ul>
</div>
<div class="section" id="filesystem-root">
<h3>Filesystem Root<a class="headerlink" href="#filesystem-root" title="Permalink to this headline">¶</a></h3>
<p>Injectable from the ServerContainer by calling the method <strong>getRootFolder()</strong>, <strong>getUserFolder()</strong> or <strong>getAppFolder()</strong>.</p>
<p>Filesystem hooks available in scope <strong>\OC\Files</strong>:</p>
<ul class="simple">
<li><strong>preWrite</strong> (\OCP\Files\Node $node)</li>
<li><strong>postWrite</strong> (\OCP\Files\Node $node)</li>
<li><strong>preCreate</strong> (\OCP\Files\Node $node)</li>
<li><strong>postCreate</strong> (\OCP\Files\Node $node)</li>
<li><strong>preDelete</strong> (\OCP\Files\Node $node)</li>
<li><strong>postDelete</strong> (\OCP\Files\Node $node)</li>
<li><strong>preTouch</strong> (\OCP\Files\Node $node, int $mtime)</li>
<li><strong>postTouch</strong> (\OCP\Files\Node $node)</li>
<li><strong>preCopy</strong> (\OCP\Files\Node $source, \OCP\Files\Node $target)</li>
<li><strong>postCopy</strong> (\OCP\Files\Node $source, \OCP\Files\Node $target)</li>
<li><strong>preRename</strong> (\OCP\Files\Node $source, \OCP\Files\Node $target)</li>
<li><strong>postRename</strong> (\OCP\Files\Node $source, \OCP\Files\Node $target)</li>
</ul>
</div>
<div class="section" id="filesystem-scanner">
<h3>Filesystem Scanner<a class="headerlink" href="#filesystem-scanner" title="Permalink to this headline">¶</a></h3>
<p>Filesystem scanner hooks available in scope <strong>\OC\Files\Utils\Scanner</strong>:</p>
<ul class="simple">
<li><strong>scanFile</strong> (string $absolutePath)</li>
<li><strong>scanFolder</strong> (string $absolutePath)</li>
<li><strong>postScanFile</strong> (string $absolutePath)</li>
<li><strong>postScanFolder</strong> (string $absolutePath)</li>
</ul>
</div>
</div>
</div>


            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="two-factor-provider.html" title="Previous Chapter: Two-factor Providers"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Two-factor Providers</span>
    </a>
  </li>
  <li class="next">
    <a href="backgroundjobs.html" title="Next Chapter: Background Jobs (Cron)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Background Jo... &raquo;</span>
    </a>
  </li>
</ul>
					</div>
				</div>
			</div>
  </main>  
  </div>
</div>
<div class="container">
<div class="row">
    <div class="col-lg-12 footer-social-icons">
      <p class="text-center"><a target="_blank" href="https://plus.google.com/104036748063781940910/about"><img width=50 src="../_static/img/social/googleplus.svg" title="Follow us on Google Plus!" alt="Follow us on Google Plus!"></img></a>
      <a target="_blank" href="https://www.facebook.com/Nextclouders"><img width=50 src="../_static/img/social/facebook.svg" title="Like our facebook page!" alt="Like our facebook page!"></img></a>
      <a target="_blank" href="https://twitter.com/Nextclouders"><img width=50 src="../_static/img/social/twitter.svg" title="Subscribe to our twitter channel!" alt="Subscribe to our twitter channel!"></img></a>
      <a target="_blank" href="https://nextcloud.com/blogfeed"><img class="img-circle" width=50 src="../_static/img/social/rss.svg" title="Subscribe to our news feed!" alt="Subscribe to our news feed!"></img></a>
      <a target="_blank" href="https://newsletter.nextcloud.com/"><img class="img-circle" width=50 src="../_static/img/social/mail.svg"  title="Subscribe to our newsletter!" alt="Subscribe to our newsletter!"></img></a></p>
    </div>
    <div class="text-center">
      <p>All documentation licensed under the <a href="https://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 Unported license</a>.</p>
      <p><a href="https://github.com/nextcloud/documentation/graphs/contributors">See who contributed to our documentation/credits</a>.</p>
    </div>
</div>
</div>
<footer class="content-info" role="contentinfo">
<div class="container">
   <div class="row">
     <div class="col-sm-2 col-sm-offset-1">
        <div class="footer-nav">
          <h4>About Nextcloud</h4>
          <ul id="menu-about" class="menu">
            <li><a href="https://nextcloud.com/about/">About us</a></li>
            <li><a href="https://nextcloud.com/contact/">Contact us</a></li>
            <li><a href="https://nextcloud.com/press/">Press</a></li>
            <li><a href="https://nextcloud.com/privacy/">Privacy policy</a></li>
          </ul>
        </div>
     </div>
     <div class="col-sm-2 col-sm-offset-2">
     </div>
     <div class="col-sm-2 col-sm-offset-2">
        <div class="footer-nav">
          <h4>Interact</h4>
          <ul id="menu-interact" class="menu">
            <li class="menu-irc-channel"><a href="https://webchat.freenode.net/?channels=nextcloud">IRC Channel</a></li>
            <li class="menu-forums"><a href="https://help.nextcloud.com/">Forums</a></li>
          </ul>
        </div>
     </div>
   </div>
   <div class="row">
      <div class="col-lg-12 footer-text">
        <p>
              &copy; Copyright 2012-2017, The Nextcloud developers.  <small><a href="https://nextcloud.com/impressum">Legal Notice</a></small><br/>
        </p>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>