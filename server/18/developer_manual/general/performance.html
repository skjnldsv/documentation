

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Performance considerations &mdash; Nextcloud latest Developer Manual latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'latest',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Debugging" href="debugging.html" />
    <link rel="prev" title="Coding style &amp; general guidelines" href="codingguidelines.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-white.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">General contributor guidelines</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct.html">Community code of conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="devenv.html">Development environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="codingguidelines.html">Coding style &amp; general guidelines</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Performance considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database-performance">Database performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#measuring-performance">Measuring performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#getting-help">Getting help</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app/index.html">App development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../android_library/index.html">Android application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_apis/index.html">Client APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">Core development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bugtracker/index.html">Bugtracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commun/index.html">Help and communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nextcloud latest Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">General contributor guidelines</a> &raquo;</li>
        
      <li>Performance considerations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/nextcloud/documentation/edit/master/developer_manual/general/performance.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="performance-considerations">
<h1>Performance considerations<a class="headerlink" href="#performance-considerations" title="Permalink to this headline">¶</a></h1>
<p>This document introduces some common considerations and tips on improving performance of Nextcloud. Speed of Nextcloud is important - nobody likes to wait and often, what is <em>just slow</em> for a small amount of data will become <em>unusable</em> with a large amount of data. Please keep these tips in mind when developing for Nextcloud and consider reviewing your app to make it faster.</p>
<div class="section" id="database-performance">
<h2>Database performance<a class="headerlink" href="#database-performance" title="Permalink to this headline">¶</a></h2>
<p>The database plays an important role in Nextcloud performance. The general rule is: database queries are very bad and should be avoided if possible. The reasons for that are:</p>
<ul class="simple">
<li>Roundtrips: Bigger Nextcloud installations have the database not installed on the application server but on a remote dedicated database server. The problem is that database queries then go over the network. These roundtrips can add up significantly if you have a lot of queries.</li>
<li>Speed. A lot of people think that databases are fast. This is not always true if you compare it with handling data internally in PHP or in the filesystem or even using key/value based storages. So every developer should always double check if the database is really the best place for the data.</li>
<li>Scalability. If you have a big Nextcloud cluster setup you usually have several Nextcloud/Web servers in parallel and a central database and a central storage. This means that everything that happens on the Nextcloud/PHP side can parallelize and can be scaled. Stuff that is happening in the database and in the storage is critical because it only exists once and can&#8217;t be scaled so easily.</li>
</ul>
<p>We can reduce the load on the database by:</p>
<ol class="arabic simple">
<li>Making sure that every query uses an index.</li>
<li>Reducing the overall number of queries.</li>
<li>If you are familiar with cache invalidation you can try caching query results in PHP.</li>
</ol>
<p>There a several ways to monitor which queries are actually executed on the database.</p>
<p>With MySQL it is very easy with just a bit of configuration:</p>
<ol class="arabic simple">
<li>Slow query log.</li>
</ol>
<p>If you put this into your my.cnf file, every query that takes longer than one second is logged to a logfile:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">slow_query_log</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">slow_query_log_file</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">slow</span><span class="o">.</span><span class="n">log</span>
<span class="n">long_query_time</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>If a query takes more than a second we have a serious problem of course. You can watch it with <cite>tail -f /var/log/mysql/mysql-slow.log</cite> while using Nextcloud.</p>
<ol class="arabic simple" start="2">
<li>log all queries.</li>
</ol>
<p>If you reduce the long_query_time to zero then every statement is logged. This is super helpful to see what is going on. Just do a <cite>tail -f</cite> on the logfile and click around in the interface or access the WebDAV interface:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">slow_query_log</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">slow_query_log_file</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">slow</span><span class="o">.</span><span class="n">log</span>
<span class="n">long_query_time</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>log queries without an index.</li>
</ol>
<p>If you increase the long_query_time to 100 and add log-queries-not-using-indexes, all the queries that are not using an index are logged. Every query should always use an index. So ideally there should be no output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span><span class="o">-</span><span class="n">queries</span><span class="o">-</span><span class="ow">not</span><span class="o">-</span><span class="n">using</span><span class="o">-</span><span class="n">indexes</span>
<span class="n">slow_query_log</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">slow_query_log_file</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">slow</span><span class="o">.</span><span class="n">log</span>
<span class="n">long_query_time</span><span class="o">=</span><span class="mi">100</span>
</pre></div>
</div>
<div class="section" id="measuring-performance">
<h3>Measuring performance<a class="headerlink" href="#measuring-performance" title="Permalink to this headline">¶</a></h3>
<p>If you do bigger changes in the architecture or the database structure you should always double check the positive or negative performance impact. There are a <a class="reference external" href="https://github.com/owncloud/administration/tree/master/performance-tests">few nice small scripts</a> that can be used for this.</p>
<p>The recommendation is to automatically do 10000 PROPFINDs or file uploads, measure the time and compare the time before and after the change.</p>
</div>
</div>
<div class="section" id="getting-help">
<h2>Getting help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h2>
<p>If you need help with performance or other issues please ask on our <a class="reference external" href="https://help.nextcloud.com">forums</a> or on our IRC channel <strong>#nextcloud-dev</strong> on <strong>irc.freenode.net</strong>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="debugging.html" class="btn btn-neutral float-right" title="Debugging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="codingguidelines.html" class="btn btn-neutral float-left" title="Coding style &amp; general guidelines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 Nextcloud GmbH.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.nextcloud.com/server/16/developer_manual">16</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/17/developer_manual">17</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/18/developer_manual">18</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/19/developer_manual">19</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/stable/developer_manual">stable</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/latest/developer_manual">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="///projects//?fromdocs=">Project Home</a>
          </dd>
          <dd>
            <a href="///builds//?fromdocs=">Builds</a>
          </dd>
      </dl>
    </div>
  </div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>