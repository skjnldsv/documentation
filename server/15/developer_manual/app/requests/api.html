

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>RESTful API &mdash; Nextcloud 15 Developer Manual 15 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'15',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="View" href="../view/index.html" />
    <link rel="prev" title="Controllers" href="controllers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo-white.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../general/index.html">General contributor guidelines</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">App development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Request lifecycle</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="routes.html">Routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">RESTful API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#modifying-the-cors-headers">Modifying the CORS headers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#front-controller">Front controller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../view/index.html">View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage and database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../classloader.html">Classloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code_signing.html">Code signing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../info.html">App metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../init.html">Navigation and pre-app configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing.html">App store publishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users.html">User management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../two-factor-provider.html">Two-factor providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hooks.html">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backgroundjobs.html">Background jobs (Cron)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../settings.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notifications.html">Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../repair.html">Repair steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publicpage.html">Public Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../android_library/index.html">Android application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client_apis/index.html">Client APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Core development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bugtracker/index.html">Bugtracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../commun/index.html">Help and communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Nextcloud 15 Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">App development</a> &raquo;</li>
        
          <li><a href="index.html">Request lifecycle</a> &raquo;</li>
        
      <li>RESTful API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/nextcloud/documentation/edit/stable15/developer_manual/app/requests/api.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="restful-api">
<h1>RESTful API<a class="headerlink" href="#restful-api" title="Permalink to this headline">¶</a></h1>
<p>Offering a RESTful API is not different from creating a <a class="reference internal" href="routes.html"><span class="doc">route</span></a> and <a class="reference internal" href="controllers.html"><span class="doc">controllers</span></a> for the web interface. It is recommended though to inherit from ApiController and add <strong>&#64;CORS</strong> annotations to the methods so that <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">web applications will also be able to access the API</a>.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">OCA\MyApp\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">\OCP\AppFramework\ApiController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\OCP\IRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthorApiController</span> <span class="k">extends</span> <span class="nx">ApiController</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$appName</span><span class="p">,</span> <span class="nx">IRequest</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$appName</span><span class="p">,</span> <span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @CORS</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>CORS also needs a separate URL for the preflighted <strong>OPTIONS</strong> request that can easily be added by adding the following route:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// appinfo/routes.php</span>
<span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;author_api#preflighted_cors&#39;</span><span class="p">,</span>
    <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/api/1.0/{path}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;verb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;requirements&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;.+&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Keep in mind that multiple apps will likely depend on the API interface once it is published and they will move at different speeds to react to changes implemented in the API. Therefore it is recommended to version the API in the URL to not break existing apps when backwards incompatible changes are introduced:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">php</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">myapp</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="mf">1.0</span><span class="o">/</span><span class="n">resource</span>
</pre></div>
</div>
<div class="section" id="modifying-the-cors-headers">
<h2>Modifying the CORS headers<a class="headerlink" href="#modifying-the-cors-headers" title="Permalink to this headline">¶</a></h2>
<p>By default the following values will be used for the preflighted OPTIONS request:</p>
<ul class="simple">
<li><strong>Access-Control-Allow-Methods</strong>: &#8216;PUT, POST, GET, DELETE, PATCH&#8217;</li>
<li><strong>Access-Control-Allow-Headers</strong>: &#8216;Authorization, Content-Type, Accept&#8217;</li>
<li><strong>Access-Control-Max-Age</strong>: 1728000</li>
</ul>
<p>To add an additional method or header or allow less headers, simply pass additional values to the parent constructor:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">OCA\MyApp\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">\OCP\AppFramework\ApiController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\OCP\IRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthorApiController</span> <span class="k">extends</span> <span class="nx">ApiController</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$appName</span><span class="p">,</span> <span class="nx">IRequest</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span>
            <span class="nv">$appName</span><span class="p">,</span>
            <span class="nv">$request</span><span class="p">,</span>
            <span class="s1">&#39;PUT, POST, GET, DELETE, PATCH&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Authorization, Content-Type, Accept&#39;</span><span class="p">,</span>
            <span class="mi">1728000</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../view/index.html" class="btn btn-neutral float-right" title="View" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="controllers.html" class="btn btn-neutral float-left" title="Controllers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 Nextcloud GmbH.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 15
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.nextcloud.com/server/15/developer_manual">15</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/16/developer_manual">16</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/17/developer_manual">17</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/stable/developer_manual">stable</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/latest/developer_manual">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="///projects//?fromdocs=">Project Home</a>
          </dd>
          <dd>
            <a href="///builds//?fromdocs=">Builds</a>
          </dd>
      </dl>
    </div>
  </div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>