<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upgrade to Nextcloud 21 &mdash; Nextcloud latest Developer Manual latest documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Upgrade to Nextcloud 20" href="upgrade_to_20.html" />
    <link rel="prev" title="Upgrade to Nextcloud 22" href="upgrade_to_22.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo-white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../prologue/index.html">Prologue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basics/index.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_development/index.html">App development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core/index.html">Core development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../digging_deeper/index.html">Digging deeper</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">App publishing and maintenance</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../maintainer.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_process.html">Release process</a></li>
<li class="toctree-l2"><a class="reference external" href="https://nextcloudappstore.readthedocs.io/en/latest/developer.html">Publishing App on the App Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing.html">The Nextcloud app store rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code_signing.html">Code signing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_automation.html">Release Automation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">App upgrade guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_27.html">Upgrade to Nextcloud 27</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_26.html">Upgrade to Nextcloud 26</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_25.html">Upgrade to Nextcloud 25</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_24.html">Upgrade to Nextcloud 24</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_23.html">Upgrade to Nextcloud 23</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_22.html">Upgrade to Nextcloud 22</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Upgrade to Nextcloud 21</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#back-end-changes">Back-end changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_20.html">Upgrade to Nextcloud 20</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_19.html">Upgrade to Nextcloud 19</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_18.html">Upgrade to Nextcloud 18</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_17.html">Upgrade to Nextcloud 17</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_16.html">Upgrade to Nextcloud 16</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_15.html">Upgrade to Nextcloud 15</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade_to_14.html">Upgrade to Nextcloud 14</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Nextcloud design guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../html_css_design/index.html">HTML/CSS guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client_apis/index.html">Clients and Client APIs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Nextcloud latest Developer Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">App publishing and maintenance</a></li>
          <li class="breadcrumb-item"><a href="index.html">App upgrade guide</a></li>
      <li class="breadcrumb-item active">Upgrade to Nextcloud 21</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/nextcloud/documentation/edit/master/developer_manual/app_publishing_maintenance/app_upgrade_guide/upgrade_to_21.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="upgrade-to-nextcloud-21">
<h1>Upgrade to Nextcloud 21<a class="headerlink" href="#upgrade-to-nextcloud-21" title="Permalink to this headline"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Critical changes were collected <a class="reference external" href="https://github.com/nextcloud/server/issues/23210">on GitHub</a>. See the original ticket for links to the pull requests and tickets.</p>
</div>
<section id="back-end-changes">
<h2>Back-end changes<a class="headerlink" href="#back-end-changes" title="Permalink to this headline"></a></h2>
<p>The biggest change in Nextcloud 21 is the initial support for PHP8 and the corresponding updates of many core dependencies, which could have direct and indirect consequences for apps.</p>
<section id="php-8-support">
<h3>PHP 8 support<a class="headerlink" href="#php-8-support" title="Permalink to this headline"></a></h3>
<p>Nextcloud 21 is the first major release that is compatible with the new PHP 8.0. As a consequence, some previously working syntax can cause problems when an app is deployed with PHP newer than 7.4. The full changelog can be found <a class="reference external" href="https://www.php.net/ChangeLog-8.php">on the php.net website</a>. There is also a document for all breaking changes <a class="reference external" href="https://github.com/php/php-src/blob/PHP-8.0/UPGRADING#L20">on GitHub</a>.</p>
<p>To check compatibility automatically we recommend adding or updating the <a class="reference internal" href="../../digging_deeper/continuous_integration.html#app-ci"><span class="std std-ref">Continuous Integration</span></a> of your app so that linters, tests and static analysis can warn you about any problems before the app is shipped to users.</p>
</section>
<section id="updated-core-libraries">
<h3>Updated core libraries<a class="headerlink" href="#updated-core-libraries" title="Permalink to this headline"></a></h3>
<p>If apps use only official public APIs of Nextcloud, the update of core libraries should have little to no effect on apps. However, there are some edge cases where an app still has a code dependency to a library shipped with Nextcloud, e.g. when those 3rdparty classes or functions are used, and therefore app developers are recommended to check their code for any incompatibility. Moreover it’s recommended to check compatibility with sophisticated tools, as documented at the  <a class="reference internal" href="../../digging_deeper/continuous_integration.html#app-static-analysis"><span class="std std-ref">static analysis</span></a> section.</p>
<section id="doctrine-dbal">
<h4><code class="docutils literal notranslate"><span class="pre">doctrine/dbal</span></code><a class="headerlink" href="#doctrine-dbal" title="Permalink to this headline"></a></h4>
<p>The Doctrine Database Abstraction Layer powers Nextcloud’s database connection and query builder. In Nextcloud 21, this dependency was updated from 2.x to 3.0. As a consequence, some types that were previously exported through the Nextcloud OCP API are removed or changed by this update. For backwards-compatibility, there is now a tiny compatibility layer between the original Doctrine API and what apps use via the Nextcloud API.</p>
<p>Optimistically speaking, the database connection and the query builder should mostly work like in Nextcloud 20 or older. The main differences are that prepared statements and query results are not handled by the removed Doctrine <code class="docutils literal notranslate"><span class="pre">Statement</span></code> but two new Nextcloud types <code class="docutils literal notranslate"><span class="pre">IPreparedStatement</span></code> and <code class="docutils literal notranslate"><span class="pre">IResult</span></code>. You don’t have to worry about these types unless you pass around the result of a query to class/method/function with type hints. In this rare case, please adjust the type hints accordingly for the new type if you only support Nextcloud 21 in your apps or remove the type hint temporarily for multi-version Nextcloud support.</p>
<p>Some (minor) breaking changes were inevitable. Here’s the summary</p>
<ul class="simple">
<li><p>Many of the database connection methods have now a documented exception that can be thrown: <code class="docutils literal notranslate"><span class="pre">\OCP\DB\Exception</span></code>. This also acts as a replacement for the removed <code class="docutils literal notranslate"><span class="pre">\Doctrine\DBAL\DBALException</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;fetch()</span></code> only has one argument now (there were three previously)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;fetchColumn()</span></code> has no more arguments and got also deprecated. Use <code class="docutils literal notranslate"><span class="pre">fetchOne</span></code> instead</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;bindParam()</span></code> was removed because conceptually it does not make sense to bind a parameter <em>after</em> executing a query. Use <code class="docutils literal notranslate"><span class="pre">bindParam</span></code> on the <code class="docutils literal notranslate"><span class="pre">IPeparedStatement</span></code> instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;bindValue()</span></code> was removed because conceptually it does not make sense to bind a value <em>after</em> executing a query. Use <code class="docutils literal notranslate"><span class="pre">bindValue</span></code> on the <code class="docutils literal notranslate"><span class="pre">IPeparedStatement</span></code> instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;columnCount()</span></code> was removed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;errorCode()</span></code> was removed from Doctrine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;errorInfo()</span></code> was removed from Doctrine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$queryBuilder-&gt;execute()-&gt;setFetchMode()</span></code> was removed from Doctrine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$connection-&gt;prepare()-&gt;execute()</span></code> previously returned <code class="docutils literal notranslate"><span class="pre">false</span></code> under some error conditions, it now always gives you an <code class="docutils literal notranslate"><span class="pre">IResult</span></code> or throws a <code class="docutils literal notranslate"><span class="pre">\OCP\DB\Exception</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\Doctrine\DBAL\Types\Type::*</span></code> type constants were moved, which some apps used for column type constants in apps. Use the new <code class="docutils literal notranslate"><span class="pre">\OCP\DB\Types::*</span></code> as a replacement.</p></li>
</ul>
<p>The details of this change can also be seen in the <a class="reference external" href="https://github.com/nextcloud/server/pull/24948">pull request on GitHub</a> and in the upstream <a class="reference external" href="https://github.com/doctrine/dbal/blob/3.0.x/UPGRADE.md">dbal 3.0.xx upgrade document</a>.</p>
</section>
<section id="guzzlehttp-guzzle">
<h4><code class="docutils literal notranslate"><span class="pre">guzzlehttp/guzzle</span></code><a class="headerlink" href="#guzzlehttp-guzzle" title="Permalink to this headline"></a></h4>
<p>The HTTP client library behind the Nextcloud HTTP client was updated for PHP 8 compatibility. The Nextcloud abstraction remained untouched and will work like before. If you used Guzzle directly, make sure you don’t use the fluent API on requests or responses.</p>
</section>
<section id="psr-log">
<h4><code class="docutils literal notranslate"><span class="pre">psr/log</span></code><a class="headerlink" href="#psr-log" title="Permalink to this headline"></a></h4>
<p>The <a class="reference internal" href="../../digging_deeper/psr.html#psr3"><span class="std std-ref">PSR-3: Logger Interface</span></a> package was updated to v1.1. The <code class="docutils literal notranslate"><span class="pre">log</span></code> method can now theoretically throw an <code class="docutils literal notranslate"><span class="pre">\Psr\Log\InvalidArgumentException</span></code>, though Nextcloud does not make use of this at the moment. It’s recommended to check any usage of the method nevertheless and add error handling if appropriate.</p>
</section>
<section id="sabre">
<h4><code class="docutils literal notranslate"><span class="pre">sabre/*</span></code><a class="headerlink" href="#sabre" title="Permalink to this headline"></a></h4>
<p>The Sabre packages received a minor update. Only apps that provide DAV functionality should be effected, if any.</p>
</section>
</section>
<section id="app-code-checker-deprecation">
<h3>App code checker deprecation<a class="headerlink" href="#app-code-checker-deprecation" title="Permalink to this headline"></a></h3>
<p>The app code checker (<code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">app:check-code</span> <span class="pre">myapp</span></code>) is obsolete due to <a class="reference internal" href="../../digging_deeper/continuous_integration.html#app-static-analysis"><span class="std std-ref">static analysis</span></a>. For Nextcloud 21 it will act as NOOP, meaning that you can still call the command but it will never fail. This allows you to still use it on CI if you test against 21, 20 and older releases. But prepare the switch to static analysis if you haven’t already. Please also note that the app code checker hadn’t received many updates recently, hence the number of issues it can detect is low.</p>
</section>
<section id="psr-0-deprecation">
<h3>PSR-0 deprecation<a class="headerlink" href="#psr-0-deprecation" title="Permalink to this headline"></a></h3>
<p>The original <cite>PSR-0</cite> standard was deprecated in 2014 and therefore the support for it in Nextcloud will also end soon. Hence we recommend migrating your class file names to <cite>PSR-4</cite>.</p>
</section>
<section id="last-version-with-database-xml-support-and-migration">
<h3>Last version with database.xml support and migration<a class="headerlink" href="#last-version-with-database-xml-support-and-migration" title="Permalink to this headline"></a></h3>
<p>Nextcloud 21 is the last major release that supports an app’s <code class="docutils literal notranslate"><span class="pre">appinfo/database.xml</span></code> to define the database schema. This is your last chance to automatically convert this deprecated file into the new migration classes using <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">migrations:generate-from-schema</span></code>.</p>
</section>
<section id="replaced-well-known-handler-api">
<h3>Replaced well-known handler API<a class="headerlink" href="#replaced-well-known-handler-api" title="Permalink to this headline"></a></h3>
<p>There was an old, unused and inofficial mechanism to hook into well-known discovery via config settings. This includes <code class="docutils literal notranslate"><span class="pre">host-meta</span></code>, <code class="docutils literal notranslate"><span class="pre">host-meta.json</span></code>, <code class="docutils literal notranslate"><span class="pre">nodeinfo</span></code> and <code class="docutils literal notranslate"><span class="pre">webfinger</span></code>. A <a class="reference internal" href="../../digging_deeper/web_host_metadata.html#web-host-metadata"><span class="std std-ref">new public API replaces this mechanism</span></a> in Nextcloud 21.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="upgrade_to_22.html" class="btn btn-neutral float-left" title="Upgrade to Nextcloud 22" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="upgrade_to_20.html" class="btn btn-neutral float-right" title="Upgrade to Nextcloud 20" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Nextcloud GmbH.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.nextcloud.com/server/25/developer_manual">25</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/26/developer_manual">26</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/27/developer_manual">27</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/stable/developer_manual">stable</a></dd>
        
          <dd><a href="https://docs.nextcloud.com/server/latest/developer_manual">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="///projects//?fromdocs=">Project Home</a>
          </dd>
          <dd>
            <a href="///builds//?fromdocs=">Builds</a>
          </dd>
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>